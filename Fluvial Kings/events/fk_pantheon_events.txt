namespace = fkp

#Hittite (Ishalitethai) Pantheon
character_event = {
	id = fkp.1
	desc = EVTDESCFKP1
	picture = GFX_evt_blessed_by_the_gods
	is_triggered_only = yes
	portrait = 1000000
	
	option = {
		name = OK
	}
}

####Boon Events
#Given Boon
character_event = { 
	id = fkp.100
	desc = EVTDESCFKP100
	picture = GFX_evt_blessed_by_the_gods
	is_triggered_only = yes
	
	option = {
		name = opta_excellent
		if = {
			limit = {
				ai = no
			}
			apply_random_boon_effect = yes
		}
		if = {
			limit = {
				ai = yes
			}
			ai_apply_random_boon_effect = yes
		}
	}
}

#Denied Boon
character_event = { 
	id = fkp.101
	desc = EVTDESCFKP101
	picture = GFX_evt_dark_court
	is_triggered_only = yes
	
	option = {
		name = opta_disappointing
		add_character_modifier = {
			modifier = denied_boon
			years = 5
		}
	}
}

####Sacrifice Events
#Choosing sacrifice type
character_event = {
	id = fkp.200
	desc = EVTDESCFKP200
	picture = GFX_evt_visit_the_temple_pantheon
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = {
				ai = no
			}
			FROM = {
				save_event_target_as = target_god
			}
		}
	}
	
	option = { #Small sacrifice
		name = EVTOPTAFKP200
		
		wealth = -50
		character_event = { id = fkp.201 }
		set_character_flag = small_sacrifice
		ai_chance = {
			factor = 40
			modifier = {
				factor = 0.5
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = greedy
			}
		}
	}
	option = { #Medium sacrifice
		name = EVTOPTBFKP200
		trigger = {
			OR = {
				ai = no
				wealth = 250
			}
		}
		
		wealth = -250
		character_event = { id = fkp.201 }
		set_character_flag = medium_sacrifice
		ai_chance = {
			factor = 25
		}
	}
	option = { #Large sacrifice
		name = EVTOPTCFKP200
		trigger = {
			OR = {
				ai = no
				wealth = 500
			}
		}
		
		wealth = -500
		character_event = { id = fkp.201 }
		set_character_flag = large_sacrifice
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

#Choose if you're going to do the actual sacrifice
character_event = {
	id = fkp.201
	desc = EVTDESCFKP201
	picture = GFX_evt_visit_the_temple_pantheon
	is_triggered_only = yes
	
	option = { #Yes
		name = EVTOPTAFKP201
		piety = 50
		hidden_tooltip = {
			random_list = {
				40 = { #Do Well
					if = {
						limit = {
							ai = yes
						}
						ai_make_sacrifice_to_evaluation_effect_self_success = yes
					}
					if = {
						limit = {
							ai = no
						}
						character_event = { id = fkp.202 }
					}
					modifier = {
						factor = 1.5
						OR = {
							trait = mastermind_theologian
							trait = erudite
							learning = 12
						}
					}
				}
				60 = { #Do Poorly
					if = {
						limit = {
							ai = yes
						}
						ai_make_sacrifice_to_evaluation_effect_self_failure = yes
					}
					if = {
						limit = {
							ai = no
						}
						character_event = { id = fkp.203 }
					}
					modifier = {
						factor = 1.2
						OR = {
							trait = dull
							learning < 10
							has_character_flag = medium_sacrifice
						}
					}
					modifier = {
						factor = 1.5
						OR = {
							trait = inbred
							trait = slow
							trait = imbecile
							has_character_flag = large_sacrifice
							learning < 10
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.2
				OR = {
					trait = proud
					learning = 12
				}
			}
		}
	}
	option = { #No
		name = EVTOPTBFKP201
		hidden_tooltip = {
			random_list = {
				60 = { #Do Well
					if = {
						limit = {
							ai = yes
						}
						ai_make_sacrifice_to_evaluation_effect_success = yes
					}
					if = {
						limit = {
							ai = no
						}
						character_event = { id = fkp.204 }
					}
					modifier = {
						factor = 1.5
						OR = {
							trait = scholarly_theologian
							trait = mastermind_theologian
							trait = erudite
							learning = 12
						}
					}
					modifier = {
						factor = 1.2
						has_character_flag = medium_sacrifice
					}
					modifier = {
						factor = 1.3
						OR = {
							trait = dull
							has_character_flag = large_sacrifice
							learning < 10
						}
					}
				}
				40 = { #Do Poorly
					if = {
						limit = {
							ai = yes
						}
						ai_make_sacrifice_to_evaluation_effect_failure = yes
					}
					if = {
						limit = {
							ai = no
						}
						character_event = { id = fkp.205 }
					}
					modifier = {
						factor = 1.5
						OR = {
							trait = inbred
							trait = slow
							trait = imbecile
							learning < 10
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 70
		}
	}
}

#Do Well in Sacrifice Self
character_event = {
	id = fkp.202
	desc = EVTDESCFKP202
	picture = GFX_evt_visit_the_temple_pantheon
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP202
		prestige = 50
		
		add_character_modifier = {
			modifier = made_sacrifice
			years = 2
		}
		
		if = {
			limit = {
				has_character_flag = small_sacrifice
			}
			piety = 30
			reverse_opinion = {
				modifier = opinion_small_sacrifice
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = medium_sacrifice
			}
			piety = 50
			reverse_opinion = {
				modifier = opinion_medium_sacrifice
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = large_sacrifice
			}
			piety = 100
			reverse_opinion = {
				modifier = opinion_large_sacrifice
				who = event_target:target_god
			}
		}
	}
}

#Do Poorly in Sacrifice Self
character_event = {
	id = fkp.203
	desc = EVTDESCFKP203
	picture = GFX_evt_dark_court
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP203
		prestige = -50
		add_character_modifier = {
			modifier = made_sacrifice
			years = 2
		}
		if = {
			limit = {
				has_character_flag = small_sacrifice
			}
			piety = -30
			reverse_opinion = {
				modifier = opinion_small_sacrifice_fail
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = medium_sacrifice
			}
			piety = -50
			reverse_opinion = {
				modifier = opinion_medium_sacrifice_fail
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = large_sacrifice
			}
			piety = -100
			reverse_opinion = {
				modifier = opinion_large_sacrifice_fail
				who = event_target:target_god
			}
		}
	}
}

#Do Well in Sacrifice
character_event = {
	id = fkp.204
	desc = EVTDESCFKP204
	picture = GFX_evt_visit_the_temple_pantheon
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP204
		add_character_modifier = {
			modifier = made_sacrifice
			years = 2
		}
		if = {
			limit = {
				has_character_flag = small_sacrifice
			}
			piety = 30
			reverse_opinion = {
				modifier = opinion_small_sacrifice
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = medium_sacrifice
			}
			piety = 50
			reverse_opinion = {
				modifier = opinion_medium_sacrifice
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = large_sacrifice
			}
			piety = 100
			reverse_opinion = {
				modifier = opinion_large_sacrifice
				who = event_target:target_god
			}
		}
	}
}

#Do Poorly in Sacrifice
character_event = {
	id = fkp.205
	desc = EVTDESCFKP205
	picture = GFX_evt_dark_court
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP205
		add_character_modifier = {
			modifier = made_sacrifice
			years = 2
		}
		if = {
			limit = {
				has_character_flag = small_sacrifice
			}
			piety = -30
			reverse_opinion = {
				modifier = opinion_small_sacrifice_fail
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = medium_sacrifice
			}
			piety = -50
			reverse_opinion = {
				modifier = opinion_medium_sacrifice_fail
				who = event_target:target_god
			}
		}
		if = {
			limit = {
				has_character_flag = large_sacrifice
			}
			piety = -100
			reverse_opinion = {
				modifier = opinion_large_sacrifice_fail
				who = event_target:target_god
			}
		}
		clr_character_flag = small_sacrifice
		clr_character_flag = medium_sacrifice
		clr_character_flag = large_sacrifice
	}
}

#Sacrifice to the Gods Absolves Curses
character_event = {
	id = fkp.206
	desc = EVTDESCFKP206
	picture = GFX_evt_dark_court
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP206
		
		piety = 100
		custom_tooltip = {
			text = all_curses_absolved_TT
			hidden_tooltip = {
				remove_curse_effect = yes
			}
		}
		any_character = {
			limit = {
				reverse_has_opinion_modifier = {
					modifier = opinion_cursed_by
					who = ROOT
				}
			}
			reverse_remove_opinion = {
				modifier = opinion_cursed_by
				who = ROOT
			}
			opinion = {
				modifier = opinion_rectified_grievance
				who = ROOT
			}
		}
	}
}

#Sacrifice Flag Clean-Up
character_event = {
	id = fkp.299
	hide_window = yes
	trigger = {
		OR = {
			has_character_flag = small_sacrifice
			has_character_flag = medium_sacrifice
			has_character_flag = large_sacrifice
		}
		has_character_modifier = made_sacrifice
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		clr_character_flag = small_sacrifice
		clr_character_flag = medium_sacrifice
		clr_character_flag = large_sacrifice
	}
}

###Curses
#Random Event to apply curses (on_yearly_pulse)
character_event = {
	id = fkp.300
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_character_flag = flag_god
	}
	
	immediate = {
		any_character = {
			limit = {
				is_landed = yes
				higher_real_tier_than = BARON
				OR = {
					outside_pantheon_trigger_no_FROM = no
					appropriate_devotion_trigger_no_FROM = no
				}
				reverse_opinion = { #God's opinion on any_character
					who = ROOT
					value < -40
				}
				NOT = {
					has_opinion_modifier = { #any_character's opinion on God
						modifier = opinion_cursed_by
						who = ROOT
					}
				}
			}
			character_event = { id = fkp.301 } #Randomly determines fate
		}
	}
}

#Randomly determines fate
character_event = {
	id = fkp.301
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			55 = {} #Nothing Happens
			45 = {
				character_event = { id = fkp.302 } #Curse
				modifier = {
					factor = 0
					FROM = { is_friend = ROOT }
				}
				modifier = {
					factor = 100
					FROM = { is_rival = ROOT }
				}
				modifier = {
					factor = 1.8
					FROM = { opinion = { who = ROOT value <= -80 } }
				}
				modifier = {
					factor = 1.6
					FROM = { opinion = { who = ROOT value <= -60 } }
				}
				modifier = {
					factor = 1.4
					FROM = { opinion = { who = ROOT value <= -40 } }
				}
				modifier = {
					factor = 1.2
					FROM = { opinion = { who = ROOT value <= -20 } }
				}
				modifier = {
					factor = 0.8
					FROM = { opinion = { who = ROOT value = 40 } }
				}
				modifier = {
					factor = 0.6
					FROM = { opinion = { who = ROOT value = 60 } }
				}
				modifier = {
					factor = 0.4
					FROM = { opinion = { who = ROOT value = 80 } }
				}
			}
		}
	}
}

#Cursed
character_event = {
	id = fkp.302
	desc = EVTDESCFKP302
	picture = GFX_evt_cursed_by_the_gods
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAFKP302
		apply_random_curse_effect_FROMFROM = yes
		remove_boon_effect_FROMFROM = yes
		opinion = {
			modifier = opinion_cursed_by
			who = FROMFROM
		}
	}
}

###Assorted Events
#Remove Excommunications from gods
character_event = {
	id = fkp.900
	hide_window = yes
	trigger = {
		has_character_flag = flag_god
		trait = excommunicated
	}
	immediate = {
		remove_trait = excommunicated
	}
}